function o(s,t,e,a,r,i,q,A){var n=typeof s=="function"?s.options:s;return t&&(n.render=t,n.staticRenderFns=e,n._compiled=!0),{exports:s,options:n}}const c={mixins:[Fieldtype],inject:["storeName"],computed:{fields(){return _.chain(this.meta.fields).map(s=>({handle:s.handle,...s.field})).values().value()}},methods:{updateKey(s,t){let e=this.value;Vue.set(e,s,t),this.update(e)},metaUpdated(s,t){this.$emit("meta-updated",{...this.meta,meta:{...this.meta.meta,[s]:t}})},errors(s){const t=this.$store.state.publish[this.storeName];return t?t.errors["seo."+s]||[]:[]}}};var d=function(){var t=this,e=t._self._c;return e("div",{staticClass:"publish-fields"},t._l(t.fields,function(a){return e("publish-field",{key:a.handle,staticClass:"form-group",attrs:{config:a,value:t.value[a.handle],meta:t.meta.meta[a.handle],"read-only":!a.localizable,errors:t.errors(a.handle)},on:{"meta-updated":function(r){return t.metaUpdated(a.handle,r)},focus:function(r){return t.$emit("focus")},blur:function(r){return t.$emit("blur")},input:function(r){return t.updateKey(a.handle,r)}}})}),1)},u=[],p=o(c,d,u);const h=p.exports,g={mixins:[Fieldtype],data(){return{autoBindChangeWatcher:!1,changeWatcherWatchDeep:!1,allowedFieldtypes:[]}},computed:{source(){return this.value.source},sourceField(){return this.value.source==="field"?this.value.value:null},componentName(){return this.config.field.type.replace(".","-")+"-fieldtype"},sourceTypeSelectOptions(){let s=[];return this.config.field!==!1&&s.push({label:__("seo-pro::messages.custom"),value:"custom"}),this.config.from_field!==!1&&s.unshift({label:__("seo-pro::messages.from_field"),value:"field"}),this.config.inherit!==!1&&s.unshift({label:__("seo-pro::messages.inherit"),value:"inherit"}),this.config.disableable&&s.push({label:__("seo-pro::messages.disable"),value:"disable"}),s},fieldConfig(){return Object.assign(this.config.field,{placeholder:this.config.placeholder})},placeholder(){return this.config.placeholder}},mounted(){let s=this.config.allowed_fieldtypes||["text","textarea","markdown","redactor"];this.allowedFieldtypes=s.concat(this.config.merge_allowed_fieldtypes||[])},methods:{sourceDropdownChanged(s){let t=this.value;t.source=s,s!=="field"&&(t.value=this.meta.defaultValue,this.$emit("meta-updated",{...this.meta,fieldMeta:this.meta.defaultFieldMeta})),this.update(t)},sourceFieldChanged(s){this.update({...this.value,value:s})},customValueChanged(s){this.update({...this.value,value:s})}}};var m=function(){var t=this,e=t._self._c;return e("div",{staticClass:"source-container flex gap-y-2 gap-x-4"},[e("div",{staticClass:"source-type-select"},[e("v-select",{attrs:{options:t.sourceTypeSelectOptions,reduce:a=>a.value,disabled:!t.config.localizable,clearable:!1,value:t.source},on:{input:t.sourceDropdownChanged}})],1),e("div",{staticClass:"flex-1"},[t.source==="inherit"?e("div",{staticClass:"text-sm text-grey inherit-placeholder"},[t.placeholder!==!1?[t._v(" "+t._s(t.placeholder)+" ")]:t._e()],2):t.source==="field"?e("div",{staticClass:"source-field-select"},[e("text-input",{attrs:{value:t.sourceField,disabled:!t.config.localizable},on:{input:t.sourceFieldChanged}})],1):t.source==="custom"?e(t.componentName,{tag:"component",attrs:{name:t.name,config:t.fieldConfig,value:t.value.value,meta:t.meta.fieldMeta,"read-only":!t.config.localizable,handle:"source_value"},on:{input:t.customValueChanged}}):t._e()],1)])},f=[],v=o(g,m,f);const x=v.exports,C={props:["status"]};var b=function(){var t=this,e=t._self._c;return e("div",[t.status==="pending"?e("span",{staticClass:"icon icon-circular-graph animation-spin"}):e("span",{staticClass:"little-dot",class:{"bg-green-600":t.status==="pass","bg-red-500":t.status==="fail","bg-orange":t.status==="warning"}})])},y=[],k=o(C,b,y);const l=k.exports,$={props:["id","initialStatus","initialScore"],data(){return{status:this.initialStatus,score:this.initialScore}},computed:{statusByScore(){if(!this.score)return this.status;if(this.score<70)return"fail";if(this.score<90)return"warning";if(this.score>=90)return"pass"}},created(){this.score||this.updateScore()},methods:{updateScore(){Statamic.$request.get(cp_url(`seo-pro/reports/${this.id}`)).then(s=>{if(s.data.status==="pending"||s.data.status==="generating"){setTimeout(()=>this.updateScore(),1e3);return}this.status=s.data.status,this.score=s.data.score})}}};var w=function(){var t=this,e=t._self._c;return e("div",[t.score?e("div",[e("seo-pro-status-icon",{staticClass:"inline-block ml-1 mr-3",attrs:{status:t.statusByScore}}),t._v(" "+t._s(t.score)+"% ")],1):e("loading-graphic",{attrs:{text:null,inline:!0}})],1)},P=[],S=o($,w,P);const R=S.exports,F={props:["item"],components:{StatusIcon:l}};var D=function(){var t=this,e=t._self._c;return e("modal",{attrs:{name:"report-details","click-to-close":!0},on:{closed:function(a){return t.$emit("closed")}}},[e("div",{staticClass:"p-0"},[e("h1",{staticClass:"p-4 bg-gray-200 dark:bg-dark-650 border-b dark:border-dark-900 text-lg"},[t._v(" "+t._s(t.__("seo-pro::messages.page_details"))+" ")]),e("div",{staticClass:"modal-body"},t._l(t.item.results,function(a){return e("div",{staticClass:"flex px-4 leading-normal pb-2",class:{"bg-red-100 dark:bg-dark-400":a.status!=="pass"}},[e("status-icon",{staticClass:"mr-3 mt-2",attrs:{status:a.status}}),e("div",{staticClass:"flex-1 mt-2 prose text-gray-700 dark:text-dark-150"},[e("div",{staticClass:"text-gray-900 dark:text-dark-100",domProps:{innerHTML:t._s(a.description)}}),a.comment?e("div",{staticClass:"text-xs",class:{"text-red-800 dark:text-dark-150":a.status!=="pass"},domProps:{innerHTML:t._s(a.comment)}}):t._e()])],1)}),0),e("footer",{staticClass:"px-4 py-3 dark:bg-dark-700 dark:border-dark-900 rounded-b-lg border-t flex items-center text-sm flex"},[t.item.url?e("a",{staticClass:"font-normal font-mono text-xs text-gray-700 hover:text-blue grow truncate",attrs:{href:t.item.url,target:"_blank"},domProps:{textContent:t._s(t.item.url)}}):t._e(),t.item.url?e("a",{staticClass:"font-normal text-gray-700 hover:text-blue ml-8",attrs:{href:t.item.url,target:"_blank"},domProps:{textContent:t._s(t.__("Visit"))}}):t._e(),t.item.edit_url?e("a",{staticClass:"font-normal text-gray-700 hover:text-blue ml-4",attrs:{href:t.item.edit_url,target:"_blank"},domProps:{textContent:t._s(t.__("Edit"))}}):t._e()])])])},I=[],T=o(F,D,I);const M=T.exports,N={props:["date"],data(){return{text:null}},mounted(){this.update()},methods:{update(){this.text=moment(this.date*1e3).fromNow(),setTimeout(()=>this.update(),6e4)}}};var V=function(){var t=this,e=t._self._c;return e("span",[t._v(t._s(t.text))])},L=[],j=o(N,V,L);const z=j.exports,O={components:{PageDetails:M,RelativeDate:z,StatusIcon:l},props:["initialReport","initialPage","initialPerPage"],data(){return{loading:!0,report:this.initialReport,selectedId:null,sortColumn:"status",sortDirection:"asc",page:this.initialPage,perPage:this.initialPerPage,paginationMeta:{}}},computed:{isGenerating(){return this.initialReport.status==="pending"||this.initialReport.status==="generating"},id(){return this.report.id},isCachedHeaderReady(){return this.report.date&&this.report.pages_crawled&&this.report.score},sortablePages(){return this.loading?[]:this.report.pages.data},parameters(){return{sortColumn:this.sortColumn,sortDirection:this.sortDirection,page:this.page,perPage:this.perPage}}},watch:{parameters:{deep:!0,handler(s,t){JSON.stringify(t)!==JSON.stringify(s)&&(this.load(),this.pushState())}}},mounted(){window.history.replaceState({parameters:this.parameters},""),window.addEventListener("popstate",this.popState)},beforeDestroy(){window.removeEventListener("popstate",this.popState)},created(){this.load()},methods:{load(){this.$axios.get(cp_url(`seo-pro/reports/${this.id}/pages`),{params:this.parameters}).then(s=>{if(s.data.status==="pending"||s.data.status==="generating"){setTimeout(()=>this.load(),1e3);return}this.report=s.data,this.sortColumn=s.data.sortColumn,this.sortDirection=s.data.sortDirection,this.page=s.data.pages.current_page,this.perPage=s.data.pages.per_page,this.paginationMeta=s.data.pages,this.loading=!1})},actionablePageResults(s){return _.chain(s.results).reject(t=>t.status==="pass").map(t=>t.actionable_pill).unique().value()},selectPaginationPage(s){this.page=parseInt(s)},selectPaginationPerPage(s){this.perPage=parseInt(s)},sorted(s,t){this.sortColumn=s,this.sortDirection=t},popState(s){s.state&&(this.popping=!0,this.page=s.state.parameters.page,this.perPage=s.state.parameters.perPage,this.$nextTick(()=>{this.popping=!1}))},pushState(){if(this.popping)return;const s=this.parameters,t=new URLSearchParams(s);window.history.pushState({parameters:s},"","?"+t.toString())}}};var H=function(){var t=this,e=t._self._c;return e("div",[e("header",{staticClass:"flex items-center mb-6"},[e("h1",{staticClass:"flex-1"},[t._v(t._s(t.__("seo-pro::messages.seo_report")))]),t.loading?t._e():e("a",{staticClass:"btn-primary",attrs:{href:t.cp_url("seo-pro/reports/create")}},[t._v(t._s(t.__("seo-pro::messages.generate_report")))])]),t.report?e("div",[t.isCachedHeaderReady?e("div",[e("h3",{staticClass:"little-heading rtl:pr-0 ltr:pl-0 mt-4 mb-2"},[t._v(t._s(t.__("Summary")))]),e("div",{staticClass:"card p-0 mt-2"},[e("div",{staticClass:"p-4 border-b dark:border-dark-900"},[e("div",{staticClass:"w-full flex"},[e("div",[e("h2",{staticClass:"text-sm text-gray-700"},[t._v(t._s(t.__("seo-pro::messages.generated")))]),e("div",{staticClass:"text-lg"},[e("relative-date",{attrs:{date:t.report.date}})],1)]),e("div",{staticClass:"grow text-right mr-8"},[e("h2",{staticClass:"text-sm text-gray-700"},[t._v(t._s(t.__("Actionable Pages")))]),e("div",{staticClass:"text-lg"},[t._v(t._s(t.report.pages_actionable||"N/A"))])]),e("div",{staticClass:"text-right mr-8"},[e("h2",{staticClass:"text-sm text-gray-700"},[t._v(t._s(t.__("Total Pages Crawled")))]),e("div",{staticClass:"text-lg"},[t._v(t._s(t.report.pages_crawled))])]),e("div",{staticClass:"text-right"},[e("h2",{staticClass:"text-sm text-gray-700"},[t._v(t._s(t.__("Site Score")))]),e("div",{staticClass:"text-lg",class:{"text-red-500":t.report.score<70,"text-orange":t.report.score<90,"text-green-600":t.report.score>=90}},[t._v(t._s(t.report.score)+"%")])])]),e("div",{staticClass:"bg-gray-300 dark:bg-dark-650 h-4 w-full rounded mr-2 mt-4"},[e("div",{staticClass:"h-4 rounded-l",class:{"bg-red-500":t.report.score<70,"bg-orange":t.report.score<90,"bg-green-600":t.report.score>=90},style:`width: ${t.report.score}%`})])]),e("table",{staticClass:"data-table"},[e("tbody",t._l(t.report.results,function(a){return e("tr",[e("td",{staticClass:"w-8 text-center"},[e("status-icon",{attrs:{status:a.status}})],1),e("td",{staticClass:"p-0"},[t._v(t._s(a.description))]),e("td",{staticClass:"text-right"},[t._v(t._s(a.comment))])])}),0)])])]):t._e(),t.loading&&t.isGenerating?e("div",{staticClass:"card loading"},[e("loading-graphic",{attrs:{text:t.__("seo-pro::messages.report_is_being_generated")}})],1):e("div",[e("h3",{staticClass:"little-heading rtl:pr-0 ltr:pl-0 mt-4 mb-2"},[t._v(t._s(t.__("seo-pro::messages.page_details")))]),t.loading?e("div",{staticClass:"card loading"},[e("loading-graphic")],1):e("data-list",{ref:"dataList",attrs:{columns:t.report.columns,rows:t.sortablePages,sort:!1,"sort-column":t.sortColumn,"sort-direction":t.sortDirection},scopedSlots:t._u([{key:"default",fn:function({filteredRows:a}){return e("div",{},[e("div",{staticClass:"card overflow-hidden p-0"},[e("data-list-table",{attrs:{rows:t.sortablePages},on:{sorted:t.sorted},scopedSlots:t._u([{key:"cell-status",fn:function({row:r}){return[e("status-icon",{staticClass:"inline-block w-5",attrs:{status:r.status}}),t._v(" "+t._s(t.__("seo-pro::messages.rules."+r.status))+" ")]}},{key:"cell-url",fn:function({row:r}){return[e("a",{staticClass:"hover:text-black dark:hover:text-dark-100",domProps:{textContent:t._s(r.url)},on:{click:function(i){i.preventDefault(),t.selectedId=r.id}}})]}},{key:"cell-actionable",fn:function({row:r}){return[t.selectedId===r.id?e("page-details",{attrs:{item:r},on:{closed:function(i){t.selectedId=null}}}):t._e(),e("a",{staticClass:"flex",staticStyle:{gap:"0.25rem"},on:{click:function(i){i.preventDefault(),t.selectedId=r.id}}},t._l(t.actionablePageResults(r),function(i){return e("span",{key:r.id+"_actionable_pill_"+i,staticClass:"inline-block text-xs bg-gray-300 dark:bg-dark-200 hover:bg-gray-800 text-gray-800 dark:text-dark-100 shrink rounded-full px-2 py-0.5 text-center justify-center",staticStyle:{"padding-top":"2px","padding-bottom":"2px"}},[t._v(t._s(i))])}),0)]}},{key:"actions",fn:function({row:r}){return e("td",{staticClass:"text-right text-xs p-0 whitespace-no-wrap"},[r.url?e("a",{staticClass:"font-normal text-gray-700 hover:text-blue",attrs:{href:r.url,target:"_blank"},domProps:{textContent:t._s(t.__("Visit"))}}):t._e(),r.edit_url?e("a",{staticClass:"font-normal text-gray-700 hover:text-blue ml-4",attrs:{href:r.edit_url,target:"_blank"},domProps:{textContent:t._s(t.__("Edit"))}}):t._e()])}}],null,!0)})],1),e("data-list-pagination",{staticClass:"mt-6",attrs:{"resource-meta":t.paginationMeta,"per-page":t.perPage,"scroll-to-top":!1,"show-totals":!0},on:{"per-page-changed":t.selectPaginationPerPage,"page-selected":t.selectPaginationPage}})],1)}}],null,!1,3781765318)})],1)]):t._e()])},B=[],U=o(O,H,B);const W=U.exports;Statamic.$components.register("seo_pro-fieldtype",h);Statamic.$components.register("seo_pro_source-fieldtype",x);Statamic.$components.register("seo-pro-status-icon",l);Statamic.$components.register("seo-pro-report",W);Statamic.$components.register("seo-pro-index-score",R);
